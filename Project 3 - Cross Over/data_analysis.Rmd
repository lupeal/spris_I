---
title: "data_analysis"
author: "Lupe Antonio"
date: "2025-03-27"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
```

# Study Design / Objectives:

MATIK is a newly discovered, highly contagious viral skin disease that causes skin rash and infectious in patients, and could even be life threatening. 

A Phase II trial is conducted to evaluate the safety and adherence of all three medications simultaneuously (Pill A, Gel B, Gel C). It is a Phase II, multi-site, randomized, open-label, three-arm crossover study. 
Note that although data was collected from various places, we assume no site specific differences.

180 MATIK patients were recruited from various health care facilities, including hospitals, primary care clinics, and community-based health services. Patients were randomized into one of six regimen sequences, where each sequence consists of three 4 week periods of study product administration followed by at least a one-week washout period. There duration of this administration period, including the two washout period, was approximately 15 weeks.


## Primary:

Compare the safety and adherence profiles of Pill A, Gel B, and Gel C. Basically:
1. whether medications are safe for patients
2. whether patients could easily adhere to medication schedules so long term use is feasible


## Secondary:

Preliminary assessment and comparison of system and local Pharmacokinetics (PK) of Pill A, Gel B, and Gel C. Additionally:
1. assess the correlation of PK with adherence measures and occurence of adverse events
2. identify demographic factors associated with product adherence and whether they differ by product (Pill or Gel) or regimen (3xs per day or 1x per day)



# Loading Data

```{r}
baseline <- read_csv("Project 3 - Cross Over/baseline.csv")

endpoints <- read_csv("Project 3 - Cross Over/endpoints.csv")
```


# Exploratory Analysis

```{r}
mean(baseline$age) #31.93

baseline %>%
  group_by(race) %>%
  count() #black (64), others (64), white (52)

baseline %>%
  group_by(gender) %>%
  count() #0 (99), 1 (81)
```


important data stuff:

bviral - viral load in blood plasma and affected tissue @ beginning of period

sviral - '' @ end of period

3 periods consist of: 1, washout, 2, washout, 3, follow-up


ae_ - # of adverse events for specific medication during specific week

adhere_ - # of days patients took specific medication during specific week



# Organizing Data

```{r}
data <- baseline %>%
  pivot_longer(cols = starts_with('period'),
               names_to = 'period', 
               values_to = 'treatment')

AE_endpts <- endpoints %>%
  pivot_longer(cols = starts_with('AE'),
               names_to = c('trt', 'week'),
               names_pattern = 'AE_(.*?)_(week\\d+)',
               values_to = 'AE')


Adhere_endpts <- endpoints %>%
  pivot_longer(cols = starts_with('Adhere'),
               names_to = c('trt', 'week'),
               names_pattern = 'Adhere_(.*?)_(week\\d+)',
               values_to = 'Adhere')


endpts <- left_join(AE_endpts, Adhere_endpts,
                    by = c('ptid', 'period1', 'period2', 'period3', 'trt', 'week'))


endpts <- endpts %>%
  pivot_longer(cols = starts_with('period'),
               names_to = 'period',
               values_to = 'treatment') 



endpts <- endpts %>%
  select(ptid, period, treatment, week, AE, Adhere)


```

```{r}
baseline_long <- baseline %>%
  mutate(age = as.numeric(age),
         ptid = as.factor(ptid),
         seq = paste0(substr(period1, nchar(period1), nchar(period1)),
                      substr(period2, nchar(period2), nchar(period2)),
                      substr(period3, nchar(period3), nchar(period3))),
         seq2 = case_when(period3 == 'Gel C' ~ 0,
                          period3 == 'Gel B' ~ 1,
                          period3 == 'Pill A' ~ 2),
         #blood virals diff for each period
         b1 = bviral1 - bviral0,
         b2 = bviral3 - bviral2,
         b3 = bviral5 - bviral4,
         b4 = bviral6,
         #skin virals diff for each period
         s1 = sviral1 - sviral0,
         s2 = sviral3 - sviral2,
         s3 = sviral5 - sviral4,
         s4 = sviral6) %>%
  select(ptid, seq, seq2, age, race, gender, b1:b4, s1:s4) %>%
  pivot_longer(cols = b1:s4,
               names_to = 'index',
               values_to = 'viral') %>%
  mutate(period = substr(index, 2, 2),
         index = ifelse(substr(index, 1, 1) == 'b', 'bviral', 'sviral'))


baseline_wide <- baseline_long %>%
  pivot_wider(names_from = index,
              values_from = viral)
```


carryover effect: use seq 2 to fit LMM model then test. 
